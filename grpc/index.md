# GRPC


<!--more-->

# gRPC

## RPC

​		RPC是远程调用过程的简写，是一个协议，处于网络通信协议的第五层：会话层，其下就是TCP/IP协议，在建立在其基础上的通信会话协议。RPC定义了交互的模式，而应用程序使用这些模式，来访问其他服务器的方法，并不需要关系具体的网络上的细节。     

​		 RPC 的全称是 Remote Procedure Call 是一种进程间通信方式。它允许程序调用另一个地址空间（通常是共享网络的另一台机器上）的过程或函数，而不用程序员显式编码这个远程调用的细节。即无论是调用本地接口/服务的还是远程的接口/服务，本质上编写的调用代码基本相同。

-   RPC 会隐藏底层的通讯细节（不需要直接处理Socket通讯或Http通迅)
- RPC 是一个请求响应模型。客户端发起请求，服务器返回响应（类似于Http的工作方式）
- RPC 在使用形式上像调用本地函数（或方法）一样去调用远程的函数（或方法）。



## RPC包含哪些部分

- 客户端和服务端建立网络连接模块( **server**模块、**client**模块 )
- 服务端**处理请求模块**
- **协议**模块
- **序列化**和**反序列**模块。

> 设计一个RPC框架，可以从PRC包含的几个模块去考虑，对每一个模块分别进行设计。
>
> - **客户端**和**服务端如何建立网络连接**？
> - **服务端**如何**处理请求**？
> - **[数据](https://www.nowcoder.com/jump/super-jump/word?word=数据)传输**采用什么**协议**？
> - **[数据](https://www.nowcoder.com/jump/super-jump/word?word=数据)**该如何**序列化**和**反序列化**？

![截屏2022-09-07 上午11.03.34](https://raw.githubusercontent.com/NoobMidC/pics/main/%E6%88%AA%E5%B1%8F2022-09-07%20%E4%B8%8A%E5%8D%8811.03.34.png)


## **服务端如何处理请求？有哪些方式？**

- **同步阻塞方式**（BIO）：客户端发一次请求，服务端生成一个对应线程去处理。当客户端同时发起的请求很多时，服务端需要创建多个线程去处理每一个请求，当达到了系统最大的线程数时，新来的请求就无法处理了。
- **同步非阻塞方式** (NIO)：客户端发一次请求，服务端并不是每次都创建一个新线程来处理，而是通过 I/O 多路复用技术进行处理。就是把多个 I/O 的阻塞复用到同一个 select 的阻塞上，从而使系统在单线程的情况下可以同时处理多个客户端请求。这种方式的优势是开销小，不用为每个请求创建一个线程，可以节省系统开销。
- **异步非阻塞方式**（AIO）：客户端发起一个 I/O 操作然后立即返回，等 I/O 操作真正完成以后，客户端会得到 I/O 操作完成的通知，此时客户端只需要对[数据]()进行处理就好了，不需要进行实际的 I/O 读写操作，因为真正的 I/O 读取或者写入操作已经由内核完成了。这种方式的优势是客户端无需等待，不存在阻塞等待问题。



## 序列化和反序列化

1. 文本类如 XML/JSON 等
2. 二进制类如 PB/Thrift 等
3. 优点:

- 解决内存中数据结构到**字节序列的映射过程中**，如何保留各个结构和字段间的关系而生的技术 。
- 解决**异构系统的数据传输**，比如大小端、远端的持久存储；
- **压缩数据，加快网络传输**



## gRPC

​		Google远程过程调用（Google Remote Procedure Call，gRPC）是基于HTTP 2.0传输层协议承载的高性能开源RPC软件框架，为管理和配置网络设备提供了一种API接口设计的方法。gRPC提供了多种编程语言，如C、Java、golong、python等。
​		gRPC可以作为数据传输协议与Telemetry技术配合使用，可实时、高速、精确的监控网络设备的运行状态。此外，网络设备提供了一种基于gRPC方式来管理设备的方法，包括配置、查询和能力获取三种方法。这些方法是通过设备和采集器对接，实现采集设备数据的功能。



## gRPC 和Restful

​		REST（Representational State Transfer）表征状态转移，是一种软件架构风格，用于指导WEB架构的设计和开发。REST同样为管理和配置网络设备提供了一种API接口设计的方法。gRPC与REST两者的主要差异如下：

- REST遵循基于HTTP 1.1的请求-响应通信模型，而gRPC遵循基于HTTP 2.0的客户端-响应通信模型。

  HTTP 2.0相对于HTTP 1.1，在速度上有着绝对的优势。虽然REST也可以基于HTTP 2.0进行数据传输，但是为了兼容HTTP 1.1方式，导致其没有充分利用HTTP 2.0的优势。

- 几乎所有的浏览器都支持RSET，而支持gRPC的浏览器非常有限。这是REST相对于gRPC的主要优势。

- REST使用JSON或XML编码格式承载数据，而gRPC默认使用ProtoBuf（Protocol Buffers）编码格式承载数据。

  ProtoBuf是二进制的，是以二进制数据进行传输，而JSON或XML编码格式以文本形式传输，所以在传输速率上gRPC更具有优势。

- REST不提供内置代码生成功能，需要使用Swagger等工具生成API请求代码。而gRPC具有protoc编译器，具有代码生成功能，而且protoc编译器与多种编程语言兼容。



## gRPC工作原理

### gRPC协议架构

​		gRPC是一种用于实现RPC API的技术。由于gRPC是开源框架，通信双方都基于该框架进行二次开发，从而使得通信双方聚焦在业务，无需关注由gRPC软件框架实现的底层通信。如下图，DATA部分即为业务层面内容，DATA下面所有的信息都由gRPC进行封装。![gRPC协议架构](https://raw.githubusercontent.com/NoobMidC/pics/main/download.png)



### gRPC模式

四种: 

1. 普通rpc
2. 客户端流
3. 服务端流
4. 双向流模式



### gRPC protobuf

​		gRPC ProtoBuf是gRPC协议的接口描述语言，是一种与语言无关、平台无关、扩展性好的用于通信协议、数据存储的序列化结构数据格式。gRPC ProtoBuf编码格式也称为GPB（Google Protocol Buffers）编码格式。GPB提供了一种灵活、高效、自动序列化结构数据的机制。GPB与XML、JSON编码类似，也是一种编码方式，但不同的是，它是一种二进制编码，性能好，效率高。

作用:

1. 定义数据结构
2. 定义服务接口
3. 通过序列化和反序列化提升传输效率

# 微服务


